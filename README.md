# üõí Order Service

–°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –Ω–∞ **Symfony 7** —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Kafka.

## üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ—Ä–≤–∏—Å

- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ inventory-service (Kafka)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ balance-service (Kafka)
- –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ –∑–∞–∫–∞–∑–∞—Ö –≤ Kafka

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
./setup.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ó–∞–ø—É—Å—Ç–∏—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Symfony —á–µ—Ä–µ–∑ Docker
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–∏—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- –ù–∞—Å—Ç—Ä–æ–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Kafka –∏ Elasticsearch

### –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose up -d

# 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Symfony (–≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)
# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
docker compose exec app /usr/local/bin/install_symfony.sh

# 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
docker compose exec app composer require \
    doctrine/doctrine-bundle \
    doctrine/doctrine-migrations-bundle \
    doctrine/orm \
    symfony/validator \
    enqueue/rdkafka \
    --no-interaction

# 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env.local
docker compose exec app cp .env .env.local

# 5. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker compose exec app php bin/console doctrine:database:create --if-not-exists
docker compose exec app php bin/console doctrine:schema:update --force
```

## üìã API Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

**POST** `http://localhost:8082/api/orders`

```json
{
    "user_id": 1,
    "items": [
        {
            "product_id": 1,
            "warehouse_id": 1,
            "quantity": 5
        },
        {
            "product_id": 2,
            "warehouse_id": 1,
            "quantity": 3
        }
    ]
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
    "success": true,
    "order_id": 1,
    "user_id": 1,
    "status": "pending",
    "total_amount": "800.00",
    "message": "Order created. Processing through Kafka..."
}
```

**–°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞:**
- `pending` - –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω, –æ–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `processing` - –∑–∞–∫–∞–∑ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- `completed` - –∑–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω
- `failed` - –∑–∞–∫–∞–∑ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —Å—Ä–µ–¥—Å—Ç–≤)

### Health check

**GET** `http://localhost:8082/health`

**–û—Ç–≤–µ—Ç:**
```json
{
    "status": "ok"
}
```

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞** ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
2. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ Kafka** ‚Üí `order-events` (—Å–æ–±—ã—Ç–∏–µ –æ —Å–æ–∑–¥–∞–Ω–∏–∏)
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤** ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –≤ `inventory-commands`
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞** ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –≤ `balance-commands`
5. **–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üí –∫–æ–º–∞–Ω–¥—ã –≤ `inventory-commands` –∏ `balance-commands`
6. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ** ‚Üí —Å—Ç–∞—Ç—É—Å `completed`, —Å–æ–±—ã—Ç–∏–µ –≤ `order-events`

## üìñ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–°–º. –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –≤ `/examples/POSTMAN_GUIDE.md`

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Kafka

–°–µ—Ä–≤–∏—Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ —á–µ—Ä–µ–∑ Kafka:

- **inventory-commands** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- **balance-commands** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞ –∏ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤
- **order-events** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
order-service/
‚îú‚îÄ‚îÄ config/          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Symfony
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ Controller/  # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ Entity/      # Doctrine —Å—É—â–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ Service/     # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ DTO/         # Data Transfer Objects
‚îÇ   ‚îî‚îÄ‚îÄ Exception/   # –ò—Å–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ public/          # –ü—É–±–ª–∏—á–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
‚îî‚îÄ‚îÄ docker/          # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```
